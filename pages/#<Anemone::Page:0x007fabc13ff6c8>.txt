 
 
 
 
 
 
 redirections nginx (301) • antoine brisset 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
         
  accueil  
  blog  
  contact  
     
  
  
 comment effectuer une redirection nginx ? 
     administration serveur  
  
     blog seo  >  administration serveur  
 publié le 21 mar 2013 
 dans le petit monde des serveurs http, nginx est encore peu répandu, en comparaison de son cousin apache. néanmoins, cette techno d'origine russe est très intéressante d'un point de vue performances. les plus gros sites l'ont d'ailleurs adopté : github et wordpress tournent ainsi sous 'engine-x'... 
 dans ce 1er article, il ne sera pas question de perf’ mais de redirections. rediriger correctement les pages de son site est en effet vital aussi bien d'un point de vue seo que d'un point de vue ux, par exemple en situation de refonte.   la grande différence avec apache, c'est qu'avec nginx vous n'avez pas accès à un fichier de type .htaccess. toutes les directives doivent être directement implémentées au niveau du fichier de configuration serveur, auquel vous pouvez avoir accès en règle générale via ce chemin  _etc/nginx/nginx.conf . si vous avez créé plusieurs virtual hosts, en revanche, les modifications seront à effectuer ici  _/etc/nginx/sites-available/votre-domaine.com . a noter que l'équivalent nginx de mod_rewrite (apache) est http rewrite module.   passons maintenant à la pratique.   redirection basique : page à page   pour effectuer une redirection d'une page vers une autre, voici comment il faut procéder dans la conf’ nginx.     server   { 
   listen   80  ; 
   server_name   www.votre-domaine.com  ; 
   rewrite    ^/votre-page.html $   http://www.votre-domaine.com/nouvelle-page.html   permanent  ; 
 } 
    a noter que si vous utilisez le flag “permanent”, la redirection sera de type 301, alors que si vous utilisez “redirect”, celle-ci sera de type 302 (temporaire).   redirection d'un set d'urls   bien entendu, il est possible de faire usage des expressions régulières, par exemple pour rediriger tout un groupe d'urls partageant une syntaxe commune.     rewrite   ^/dossier/pages-id-.*.html $  http://www.votre-domaine.com/nouveau-dossier/pages-  $1  .html   permanent  ; 
    redirection d'une url avec paramètres vers une url sans paramètres   dans le cas d'une url avec paramètres, que vous souhaiteriez rediriger vers une nouvelle url débarrassée de ces paramètres, voici la bonne manière de faire. ici, le paramètre est par exemple ?page.     location   ~   /ancienne-page.php   { 
   if   (  $args   ~   page=100)  { 
     rewrite   ^   http://www.votre-domaine.com/nouvelle-page.html?   permanent  ; 
   } 
 } 
    c'est le point d'interrogation qui donne l'instruction à nginx de ne pas ajouter les éventuels paramètres derrière l'url. “args” permet de définir les paramètres à matcher. location permet de définir le pattern d'urls concernés par le rewrite. le tilde introduit une regexp (case sensitive).   redirection d'une url si un paramètre existe   si vous voulez rediriger tout un set d'urls contenant un paramètre, peu importe la valeur, vers une url sans paramètre voici la syntaxe à adopter avec ici un paramètre ?page par exemple     location   ~   /ancienne-page.php   { 
   if   (  $arg_page   !=   "")  { 
     rewrite   ^ http://www.votre-domaine.com/nouvelle-page.html?   permanent  ; 
   } 
 } 
    si vous voulez faire la même chose mais en conservant les paramètres dans l'url de destination, voici comment procéder. dans l'exemple ci-dessous, on redirige les urls contenant le paramètre page vers une url où la valeur de ce paramètre est passée dans le slug.     location   ~   /ancienne-page.php   { 
   if   (  $arg_page   !=   "")  { 
     rewrite   ^   http://www.votre-domaine.com/nouvelle-page/  $arg_page  ?   permanent  ; 
   } 
 } 
    redirection vers le sous-domaine www   si vous souhaitez que toutes les requêtes sur votre-domaine.com soient redirigées vers www.votre_domaine.com, voici le code à utiliser.     server   { 
   listen   80  ; 
   server_name   votre-domaine.com  ; 
   rewrite   ^/(.*)   http://www.votre_domaine.com/  $1   permanent  ; 
 } 
    redirection ou code serveur spécifique en fonction du user-agent   vous pouvez également avoir besoin d'effectuer une action spécifique en fonction du user agent qui se présente. par exemple, envoyer un forbidden sur une page que googlebot ou bingbot ne doivent pas crawler, comme une page de login wordpress.     location   ~   (wp-admin|wp-login\.php)   { 
   if   (  $http_user_agent   ~  *   "(bingbot|googlebot)")   { 
     return   403  ; 
     break  ; 
   } 
 } 
    ici on target les pages wp-login.php et wp-admin. on vérifie si l'user-agent demandant la page est googlebot ou bingbot. si c'est le cas, on envoie un code d'erreur 403. l'utilisation du tilde + étoile permet de rendre la regexp case insensitive. attention ! l'utilisation de “break” indique que le serveur ne doit appliquer les directives qu'à l'intérieur du bloc défini par “location”. a l'inverse avec “last”, le serveur recherche une uri qui pourrait matcher avec le pattern dans tous les blocs “location” et applique le process défini s'il en trouve une.   bonus : définir une page à renvoyer en fonction d'un code serveur   avec nginx, vous pouvez  également définir quelle url doit être appelée en fonction d'un header http spécifique. voici un exemple avec le code d'erreur 404.     error_page   404   /404.html  ; 
    voilà donc quelques exemples de syntaxes à connaître pour gérer vos redirections. j'aborderai la question de la perf dans un autre article ;)        comments powered by  disqus      
  
 
 
   saint andré lez lille 
 
   06 12 71 82 78 
 
    contact@antoine-brisset.com   
 
 
      
      
      
 
  © 2015 -  antoine brisset 
 
  
 
 
